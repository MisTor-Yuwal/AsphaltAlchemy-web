{% extends "frontend/productbase.html" %}

{% block title %} Products - AsphaltAlchemy {% endblock %}

{% block content %}

   <div class="product-container" id="product-container">
        <div class="product-grid">
            {% for product in products %}  
                {% if product.productQuantity < 1 %}
                    <a onmousedown="this.classList.add('change')" onmouseup="this.classList.add('change')" class="product-unclickable font" href="">        
                        <div class="product-photo-sec" id="productDiv">
                            <div class="product-img">
                                <div class="product-sub-img-sec">
                                    {% if product.exists %}
                                        {% elif product.image %}
                                            <img src="{{ url_for('static', filename='uploads/' + product.image[0].file_name) }}" alt="" class="product-list-img">

                                        {% else %} 
                                            <img src="{{ url_for('static', filename='gallery/non2.jpeg' ) }}" alt="" class="product-list-img">
                                    {% endif %}
                                </div>
                            </div>
                            <div class="product-spec">
                                <div class="product-title">
                                    <div class="product-sub-title">
                                        {{ product.productName }}
                                    </div>
                                    <div class="product-sub-detail">
                                        <span class="product-price-main">{{ product.productPrice }}</span>
                                        {% if product.recent_offer %}
                                            <span class="product-discount">
                                                - {{ product.recent_offer.discount_percentage }}%
                                            </span>
                                        {% else %}
                                            <span></span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                {% else %}
                    <a onmousedown="this.classList.add('change')" onmouseup="this.classList.add('change')" class="product-link font" href="{{ url_for('views.product_detail', productID=product.productID) }}">        
                        <div class="product-photo-sec" id="productDiv">
                            <div class="product-img">
                                <div class="product-sub-img-sec">
                                    {% if product.exists %}
                                        {% elif product.image %}
                                            <img src="{{ url_for('static', filename='uploads/' + product.image[0].file_name) }}" alt="" class="product-list-img">

                                        {% else %} 
                                            <img src="{{ url_for('static', filename='gallery/non2.jpeg' ) }}" alt="" class="product-list-img">
                                    {% endif %}
                                </div>
                            </div>
                            <div class="product-spec">
                                <div class="product-title">
                                    <div class="product-sub-title">
                                        {{ product.productName }}
                                    </div>
                                    <div class="product-sub-detail">
                                        <span class="product-price-main">{{ product.productPrice }}</span>
                                        {% if product.recent_offer %}
                                            <span class="product-discount">
                                                - {{ product.recent_offer.discount_percentage }}%
                                            </span>
                                        {% else %}
                                            <span></span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                {% endif %}
             {% endfor %}
        </div>
    </div>
{% endblock %}
{% block script %}
<script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
<script>
    const socket = io();

    socket.on('new_product', function(data) {
        const productGrid = document.querySelector('.product-grid');

        const productHTML = `
            <a class="product-link font" href="/product/${data.id}">
                <div class="product-photo-sec" id="productDiv">
                    <div class="product-img">
                        <div class="product-sub-img-sec">
                            <img src="/static/uploads/${data.image}" alt="${data.name}" class="product-list-img">
                        </div>
                    </div>
                    <div class="product-spec">
                        <div class="product-title">
                            <div class="product-sub-title">${data.name}</div>
                            <div class="product-sub-detail">
                                <span class="product-price-main">${data.price}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
        `;

        productGrid.insertAdjacentHTML('afterbegin', productHTML);
    });
</script>
{% endblock %}